// Name of the executable with probes. This must either be an absolute path, or
// something that can be found from $PATH.
//
// If you're doing local development on this tapset, you may wish to
// temporarily change this value. For instance, if you might want to change it
// to "src/bitcoind" if you're working out of the bitcoin top level directory
// and want to run commands like "stap -c ./src/bitcoind". Likewise, if you want
// to probe bitcoin-qt you would change the name here.
@define BITCOIND
%(
  "bitcoind"
%)

probe bitcoin = process(@BITCOIND) {}

probe bitcoin.init_main = process(@BITCOIND).mark("init_main") {
  datadir = user_string($arg1)
  config = user_string($arg2)
}

probe bitcoin.cache_flush = process(@BITCOIND).mark("cache_flush") {
  coins = $arg1
  bytes = $arg2
}

probe bitcoin.cache_hit = process(@BITCOIND).mark("cache_hit") {}

probe bitcoin.cache_miss = process(@BITCOIND).mark("cache_miss") {}

probe bitcoin.finish_ibd = process(@BITCOIND).mark("finish_ibd") {}

probe bitcoin.read_block_from_disk = process(@BITCOIND).mark("read_block_from_disk") {
  height = $arg1
  filenum = $arg2
}

probe bitcoin.update_tip = process(@BITCOIND).mark("update_tip") {
  block = user_string($arg1)
  height = $arg2
  cache_size = $arg3
  cache_bytes = $arg4
  progress = $arg5
}

probe bitcoin.malloc_info = process(@BITCOIND).mark("malloc__info") {
  reason = user_string($arg1)
  uordblks = $arg2
  fordblks = $arg3
}
